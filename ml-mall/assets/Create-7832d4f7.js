import{c as D,f as P,b4 as M,t as w,ae as j,X as F,b5 as z,d as N,b as o,l as E,af as J,aG as W,I as Q,P as Y,a1 as Z,w as $,n as ee,av as ne,r as T,am as G,a6 as oe,b6 as te,b7 as L,aK as ae,b8 as se,b9 as le,e as ce,a7 as re,b2 as ie,b3 as de,_ as ue,x as me,aq as fe,p as A,F as R,U,J as ge,T as _e,s as pe,at as H,q as ve}from"./user-0aef1c91.js";/* empty css              *//* empty css              */import{S as he}from"./index-b410530f.js";import"./index-517c6840.js";import{F as be}from"./index-e62943ec.js";/* empty css              */import"./index-1aa94732.js";import{C as Be}from"./index-88acc341.js";import"./index-4969e190.js";import"./index-d4b43d7f.js";import{A as Ce}from"./index-ae2a0a77.js";import{N as we}from"./index-7f807b9d.js";import{c as K}from"./order-481e9a4f.js";import{L as ye}from"./index-47ddee7f.js";import{B as q}from"./index-98a02491.js";import{a as V,b as ke}from"./index-dc6fe435.js";import"./use-route-dd9e823b.js";import"./use-id-90fe8789.js";import"./index-edc94503.js";const[xe,f]=D("action-sheet"),Se=P({},M,{title:String,round:w,actions:j(),closeIcon:F("cross"),closeable:w,cancelText:String,description:String,closeOnPopstate:w,closeOnClickAction:Boolean,safeAreaInsetBottom:w}),Pe=[...z,"round","closeOnPopstate","safeAreaInsetBottom"];var Ie=N({name:xe,props:Se,emits:["select","cancel","update:show"],setup(e,{slots:s,emit:a}){const d=l=>a("update:show",l),t=()=>{d(!1),a("cancel")},_=()=>{if(e.title)return o("div",{class:f("header")},[e.title,e.closeable&&o(Q,{name:e.closeIcon,class:[f("close"),Y],onClick:t},null)])},y=()=>{if(s.cancel||e.cancelText)return[o("div",{class:f("gap")},null),o("button",{type:"button",class:f("cancel"),onClick:t},[s.cancel?s.cancel():e.cancelText])]},k=(l,B)=>l.loading?o(ye,{class:f("loading-icon")},null):s.action?s.action({action:l,index:B}):[o("span",{class:f("name")},[l.name]),l.subname&&o("div",{class:f("subname")},[l.subname])],b=(l,B)=>{const{color:S,loading:c,callback:r,disabled:p,className:m}=l,n=()=>{p||c||(r&&r(l),e.closeOnClickAction&&d(!1),Z(()=>a("select",l,B)))};return o("button",{type:"button",style:{color:S},class:[f("item",{loading:c,disabled:p}),m],onClick:n},[k(l,B)])},C=()=>{if(e.description||s.description){const l=s.description?s.description():e.description;return o("div",{class:f("description")},[l])}};return()=>o(W,E({class:f(),position:"bottom","onUpdate:show":d},J(e,Pe)),{default:()=>{var l;return[_(),C(),o("div",{class:f("content")},[e.actions.map(b),(l=s.default)==null?void 0:l.call(s)]),y()]}})}});const Te=$(Ie),[Ae,g,I]=D("dialog"),Oe=P({},M,{title:String,theme:String,width:ee,message:[String,Function],callback:Function,allowHtml:Boolean,className:ne,transition:F("van-dialog-bounce"),messageAlign:String,closeOnPopstate:w,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:w,closeOnClickOverlay:Boolean}),De=[...z,"transition","closeOnPopstate"];var X=N({name:Ae,props:Oe,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:s,slots:a}){const d=T(),t=G({confirm:!1,cancel:!1}),_=n=>s("update:show",n),y=n=>{var i;_(!1),(i=e.callback)==null||i.call(e,n)},k=n=>()=>{e.show&&(s(n),e.beforeClose?(t[n]=!0,ce(e.beforeClose,{args:[n],done(){y(n),t[n]=!1},canceled(){t[n]=!1}})):y(n))},b=k("cancel"),C=k("confirm"),l=te(n=>{var i,v;if(n.target!==((v=(i=d.value)==null?void 0:i.popupRef)==null?void 0:v.value))return;({Enter:e.showConfirmButton?C:L,Escape:e.showCancelButton?b:L})[n.key](),s("keydown",n)},["enter","esc"]),B=()=>{const n=a.title?a.title():e.title;if(n)return o("div",{class:g("header",{isolated:!e.message&&!a.default})},[n])},S=n=>{const{message:i,allowHtml:v,messageAlign:h}=e,x=g("message",{"has-title":n,[h]:h}),u=ae(i)?i():i;return v&&typeof u=="string"?o("div",{class:x,innerHTML:u},null):o("div",{class:x},[u])},c=()=>{if(a.default)return o("div",{class:g("content")},[a.default()]);const{title:n,message:i,allowHtml:v}=e;if(i){const h=!!(n||a.title);return o("div",{key:v?1:0,class:g("content",{isolated:!h})},[S(h)])}},r=()=>o("div",{class:[le,g("footer")]},[e.showCancelButton&&o(q,{size:"large",text:e.cancelButtonText||I("cancel"),class:g("cancel"),style:{color:e.cancelButtonColor},loading:t.cancel,disabled:e.cancelButtonDisabled,onClick:b},null),e.showConfirmButton&&o(q,{size:"large",text:e.confirmButtonText||I("confirm"),class:[g("confirm"),{[se]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:t.confirm,disabled:e.confirmButtonDisabled,onClick:C},null)]),p=()=>o(ke,{class:g("footer")},{default:()=>[e.showCancelButton&&o(V,{type:"warning",text:e.cancelButtonText||I("cancel"),class:g("cancel"),color:e.cancelButtonColor,loading:t.cancel,disabled:e.cancelButtonDisabled,onClick:b},null),e.showConfirmButton&&o(V,{type:"danger",text:e.confirmButtonText||I("confirm"),class:g("confirm"),color:e.confirmButtonColor,loading:t.confirm,disabled:e.confirmButtonDisabled,onClick:C},null)]}),m=()=>a.footer?a.footer():e.theme==="round-button"?p():r();return()=>{const{width:n,title:i,theme:v,message:h,className:x}=e;return o(W,E({ref:d,role:"dialog",class:[g([v]),x],style:{width:oe(n)},tabindex:0,"aria-labelledby":i||h,onKeydown:l,"onUpdate:show":_},J(e,De)),{default:()=>[B(),c(),m()]})}}});let O;const Fe={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let Ne=P({},Fe);function Ee(){({instance:O}=ie({setup(){const{state:s,toggle:a}=de();return()=>o(X,E(s,{"onUpdate:show":a}),null)}}))}function $e(e){return re?new Promise((s,a)=>{O||Ee(),O.open(P({},Ne,e,{callback:d=>{(d==="confirm"?s:a)(d)}}))}):Promise.resolve()}const Le=e=>$e(P({showCancelButton:!0},e));$(X);const[Re,Ue]=D("divider"),He={dashed:Boolean,hairline:w,contentPosition:F("center")};var Ke=N({name:Re,props:He,setup(e,{slots:s}){return()=>{var a;return o("div",{role:"separator",class:Ue({dashed:e.dashed,hairline:e.hairline,[`content-${e.contentPosition}`]:!!s.default})},[(a=s.default)==null?void 0:a.call(s)])}}});const qe=$(Ke);const Ve={class:"container"},Me={class:"address"},ze={class:"goods_list"},Je={__name:"Create",setup(e){const s=me(),a=fe(),d=T("");s.query.orderInfo||a.replace("/cart");const t=T(JSON.parse(decodeURI(atob(s.query.orderInfo||"")||"")||"[]"));console.table(t.value);const _=t.value.goods.map(c=>c.cartId).filter(c=>c);console.log(_);const y=G([{id:"1",name:t.value.consignee_name,tel:t.value.consignee_phone,address:t.value.consignee_address,isDefault:t.value.isDefault}]),k=()=>{Le({message:"退出生成订单?"}).then(()=>{a.replace("/order")}).catch(()=>{})},b=T(!1),C=[{name:"微信",pay_type:1},{name:"支付宝",pay_type:2},{name:"云闪付",pay_type:3}],l=async c=>{const r=t.value.goods.map(n=>({goods_id:n.goods_id,count:n.count}));if(!r.length){a.replace("/order");return}console.log(r);const p={pay_type:c.pay_type,status:2,remark:d.value,price:t.value.price,consignee_name:t.value.consignee_name,consignee_phone:t.value.consignee_phone,consignee_address:t.value.consignee_address,order_goods_infos:r},m=await K(p);if(_.length){const n=await H(_);console.log(n),console.log("--------------------------------------")}console.log(m),console.log(c),a.replace("/order")},B=async()=>{const c=t.value.goods.map(m=>({goods_id:m.goods_id,count:m.count}));if(!c.length){a.replace("/order");return}console.log(c);const r={pay_type:0,status:1,remark:d.value,price:t.value.price,consignee_name:t.value.consignee_name,consignee_phone:t.value.consignee_phone,consignee_address:t.value.consignee_address,order_goods_infos:c},p=await K(r);if(console.log(p),_.length){const m=await H(_);console.log(m)}a.replace("/order")},S=()=>{b.value=!0};return(c,r)=>{const p=we,m=Ce,n=qe,i=Be,v=be,h=he,x=Te;return A(),R("div",Ve,[o(p,{"left-arrow":"",onClickLeft:k,title:c.$route.meta.title,placeholder:"",fixed:""},null,8,["title"]),U("div",Me,[o(m,{class:"address_list",list:y,"default-tag-text":"默认",switchable:!1},null,8,["list"]),o(n,{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 0"},dashed:""})]),U("div",ze,[(A(!0),R(ge,null,_e(t.value.goods,u=>(A(),ve(i,{key:u.goods_id,num:u.count,price:(u.goodsInfo.price/100).toFixed(2),desc:u.goodsInfo.detail_info,title:u.goodsInfo.name,thumb:u.goodsInfo.pic_url},null,8,["num","price","desc","title","thumb"]))),128))]),o(h,{price:t.value.price,"button-text":"生成订单",onSubmit:S,placeholder:""},{top:pe(()=>[o(v,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=u=>d.value=u),modelModifiers:{trim:!0},type:"textarea",label:"备注",placeholder:"备注",rows:"3",maxlength:"50","show-word-limit":"",rules:[{required:!0,message:"请填写备注"}]},null,8,["modelValue"])]),_:1},8,["price"]),o(x,{show:b.value,"onUpdate:show":r[1]||(r[1]=u=>b.value=u),actions:C,"cancel-text":"取消","close-on-click-action":"",onSelect:l,onCancel:B},null,8,["show"])])}}},gn=ue(Je,[["__scopeId","data-v-97ce064a"]]);export{gn as default};
