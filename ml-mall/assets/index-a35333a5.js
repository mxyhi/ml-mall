import{c as J,n as F,t as ae,d as X,u as Be,aw as re,T as ce,a as d,a4 as Y,w as ue,ax as Oe,ay as Le,l as de,az as Ae,aA as Re,a7 as L,m as Fe,e as H,ap as G,a8 as Ne,r as j,h as _e,i as _,X as ze,aB as $e,D as q,M as D,A as fe,ab as De,a2 as O,aC as oe,a1 as We,I as p,aD as je,k as Q,s as pe,a3 as qe,aE as He,aF as Ue,W as Ke,aG as Ye,al as Ge,aH as Je,aI as Xe,f as Qe}from"./user-0dd1e069.js";import{c as Ze,C as et}from"./index-d4ce09a5.js";import{u as tt}from"./use-id-d165ec44.js";import{L as nt}from"./index-c1d7c59c.js";const[at,ot]=J("form"),it={colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:F,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:ae,showErrorMessage:ae,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var lt=X({name:at,props:it,emits:["submit","failed"],setup(e,{emit:n,slots:i}){const{children:r,linkChildren:o}=Be(re),c=a=>a?r.filter(u=>a.includes(u.name)):r,V=a=>new Promise((u,y)=>{const k=[];c(a).reduce((N,U)=>N.then(()=>{if(!k.length)return U.validate().then(B=>{B&&k.push(B)})}),Promise.resolve()).then(()=>{k.length?y(k):u()})}),T=a=>new Promise((u,y)=>{const k=c(a);Promise.all(k.map(w=>w.validate())).then(w=>{w=w.filter(Boolean),w.length?y(w):u()})}),g=a=>{const u=r.find(y=>y.name===a);return u?new Promise((y,k)=>{u.validate().then(w=>{w?k(w):y()})}):Promise.reject()},b=a=>typeof a=="string"?g(a):e.validateFirst?V(a):T(a),h=a=>{typeof a=="string"&&(a=[a]),c(a).forEach(y=>{y.resetValidation()})},S=()=>r.reduce((a,u)=>(a[u.name]=u.getValidationStatus(),a),{}),v=(a,u)=>{r.some(y=>y.name===a?(y.$el.scrollIntoView(u),!0):!1)},M=()=>r.reduce((a,u)=>(u.name!==void 0&&(a[u.name]=u.formValue.value),a),{}),P=()=>{const a=M();b().then(()=>n("submit",a)).catch(u=>{n("failed",{values:a,errors:u}),e.scrollToError&&u[0].name&&v(u[0].name)})},A=a=>{Y(a),P()};return o({props:e}),ce({submit:P,validate:b,getValues:M,scrollToField:v,resetValidation:h,getValidationStatus:S}),()=>{var a;return d("form",{class:ot(),onSubmit:A},[(a=i.default)==null?void 0:a.call(i)])}}});const Lt=ue(lt);function ge(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function st(e,n){if(ge(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function rt(e,n){return new Promise(i=>{const r=n.validator(e,n);if(Ae(r)){r.then(i);return}i(r)})}function ie(e,n){const{message:i}=n;return Re(i)?i(e,n):i||""}function ct({target:e}){e.composing=!0}function le({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function ut(e,n){const i=Oe();e.style.height="auto";let r=e.scrollHeight;if(de(n)){const{maxHeight:o,minHeight:c}=n;o!==void 0&&(r=Math.min(r,o)),c!==void 0&&(r=Math.max(r,c))}r&&(e.style.height=`${r}px`,Le(i))}function dt(e){return e==="number"?{type:"text",inputmode:"decimal"}:e==="digit"?{type:"tel",inputmode:"numeric"}:{type:e}}function E(e){return[...e].length}function K(e,n){return[...e].slice(0,n).join("")}const[ft,I]=J("field"),gt={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:F,formatter:Function,clearIcon:L("clear"),modelValue:Fe(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:L("focus"),formatTrigger:L("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},mt=H({},Ze,gt,{rows:F,type:L("text"),rules:Array,autosize:[Boolean,Object],labelWidth:F,labelClass:G,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var ht=X({name:ft,props:mt,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:i}){const r=tt(),o=Ne({status:"unvalidated",focused:!1,validateMessage:""}),c=j(),V=j(),T=j(),{parent:g}=_e(re),b=()=>{var t;return String((t=e.modelValue)!=null?t:"")},h=t=>{if(O(e[t]))return e[t];if(g&&O(g.props[t]))return g.props[t]},S=_(()=>{const t=h("readonly");if(e.clearable&&!t){const s=b()!=="",l=e.clearTrigger==="always"||e.clearTrigger==="focus"&&o.focused;return s&&l}return!1}),v=_(()=>T.value&&i.input?T.value():e.modelValue),M=t=>t.reduce((s,l)=>s.then(()=>{if(o.status==="failed")return;let{value:f}=v;if(l.formatter&&(f=l.formatter(f,l)),!st(f,l)){o.status="failed",o.validateMessage=ie(f,l);return}if(l.validator)return ge(f)&&l.validateEmpty===!1?void 0:rt(f,l).then(m=>{m&&typeof m=="string"?(o.status="failed",o.validateMessage=m):m===!1&&(o.status="failed",o.validateMessage=ie(f,l))})}),Promise.resolve()),P=()=>{o.status="unvalidated",o.validateMessage=""},A=()=>n("endValidate",{status:o.status,message:o.validateMessage}),a=(t=e.rules)=>new Promise(s=>{P(),t?(n("startValidate"),M(t).then(()=>{o.status==="failed"?(s({name:e.name,message:o.validateMessage}),A()):(o.status="passed",s(),A())})):s()}),u=t=>{if(g&&e.rules){const{validateTrigger:s}=g.props,l=oe(s).includes(t),f=e.rules.filter(m=>m.trigger?oe(m.trigger).includes(t):l);f.length&&a(f)}},y=t=>{var s;const{maxlength:l}=e;if(O(l)&&E(t)>l){const f=b();if(f&&E(f)===+l)return f;const m=(s=c.value)==null?void 0:s.selectionEnd;if(o.focused&&m){const C=[...t],x=C.length-+l;return C.splice(m-x,x),C.join("")}return K(t,+l)}return t},k=(t,s="onChange")=>{const l=t;t=y(t);const f=E(l)-E(t);if(e.type==="number"||e.type==="digit"){const C=e.type==="number";t=We(t,C,C)}let m=0;if(e.formatter&&s===e.formatTrigger){const{formatter:C,maxlength:x}=e;if(t=C(t),O(x)&&E(t)>x&&(t=K(t,+x)),c.value&&o.focused){const{selectionEnd:$}=c.value,ne=K(l,$);m=E(C(ne))-E(ne)}}if(c.value&&c.value.value!==t)if(o.focused){let{selectionStart:C,selectionEnd:x}=c.value;if(c.value.value=t,O(C)&&O(x)){const $=E(t);f?(C-=f,x-=f):m&&(C+=m,x+=m),c.value.setSelectionRange(Math.min(C,$),Math.min(x,$))}}else c.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},w=t=>{t.target.composing||k(t.target.value)},N=()=>{var t;return(t=c.value)==null?void 0:t.blur()},U=()=>{var t;return(t=c.value)==null?void 0:t.focus()},B=()=>{const t=c.value;e.type==="textarea"&&e.autosize&&t&&ut(t,e.autosize)},he=t=>{o.focused=!0,n("focus",t),D(B),h("readonly")&&N()},ve=t=>{h("readonly")||(o.focused=!1,k(b(),"onBlur"),n("blur",t),u("onBlur"),D(B),qe())},Z=t=>n("clickInput",t),be=t=>n("clickLeftIcon",t),ye=t=>n("clickRightIcon",t),Ce=t=>{Y(t),n("update:modelValue",""),n("clear",t)},ee=_(()=>{if(typeof e.error=="boolean")return e.error;if(g&&g.props.showError&&o.status==="failed")return!0}),Se=_(()=>{const t=h("labelWidth");if(t)return{width:ze(t)}}),ke=t=>{t.keyCode===13&&(!(g&&g.props.submitOnEnter)&&e.type!=="textarea"&&Y(t),e.type==="search"&&N()),n("keypress",t)},te=()=>e.id||`${r}-input`,we=()=>o.status,Ie=()=>{const t=I("control",[h("inputAlign"),{error:ee.value,custom:!!i.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(i.input)return d("div",{class:t,onClick:Z},[i.input()]);const s={id:te(),ref:c,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:h("disabled"),readonly:h("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,enterkeyhint:e.enterkeyhint,"aria-labelledby":e.label?`${r}-label`:void 0,onBlur:ve,onFocus:he,onInput:w,onClick:Z,onChange:le,onKeypress:ke,onCompositionend:le,onCompositionstart:ct};return e.type==="textarea"?d("textarea",s,null):d("input",Q(dt(e.type),s),null)},xe=()=>{const t=i["left-icon"];if(e.leftIcon||t)return d("div",{class:I("left-icon"),onClick:be},[t?t():d(p,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Ve=()=>{const t=i["right-icon"];if(e.rightIcon||t)return d("div",{class:I("right-icon"),onClick:ye},[t?t():d(p,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},Te=()=>{if(e.showWordLimit&&e.maxlength){const t=E(b());return d("div",{class:I("word-limit")},[d("span",{class:I("word-num")},[t]),pe("/"),e.maxlength])}},Pe=()=>{if(g&&g.props.showErrorMessage===!1)return;const t=e.errorMessage||o.validateMessage;if(t){const s=i["error-message"],l=h("errorMessageAlign");return d("div",{class:I("error-message",l)},[s?s({message:t}):t])}},Ee=()=>{const t=h("colon")?":":"";if(i.label)return[i.label(),t];if(e.label)return d("label",{id:`${r}-label`,for:te()},[e.label+t])},Me=()=>[d("div",{class:I("body")},[Ie(),S.value&&d(p,{ref:V,name:e.clearIcon,class:I("clear")},null),Ve(),i.button&&d("div",{class:I("button")},[i.button()])]),Te(),Pe()];return ce({blur:N,focus:U,validate:a,formValue:v,resetValidation:P,getValidationStatus:we}),$e(je,{customValue:T,resetValidation:P,validateWithTrigger:u}),q(()=>e.modelValue,()=>{k(b()),P(),u("onChange"),D(B)}),fe(()=>{k(b(),e.formatTrigger),D(B)}),De("touchstart",Ce,{target:_(()=>{var t;return(t=V.value)==null?void 0:t.$el})}),()=>{const t=h("disabled"),s=h("labelAlign"),l=xe(),f=()=>{const m=Ee();return s==="top"?[l,m].filter(Boolean):m||[]};return d(et,{size:e.size,class:I({error:ee.value,disabled:t,[`label-${s}`]:s}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:Se.value,valueClass:I("value"),titleClass:[I("label",[s,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:l&&s!=="top"?()=>l:null,title:f,value:Me,extra:i.extra})}}});const At=ue(ht);let z=0;function vt(e){e?(z||document.body.classList.add("van-toast--unclickable"),z++):z&&(z--,z||document.body.classList.remove("van-toast--unclickable"))}const[bt,R]=J("toast"),yt=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay"],Ct={icon:String,show:Boolean,type:L("text"),overlay:Boolean,message:F,iconSize:F,duration:He(2e3),position:L("middle"),teleport:[String,Object],wordBreak:String,className:G,iconPrefix:String,transition:L("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:G,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean};var St=X({name:bt,props:Ct,emits:["update:show"],setup(e,{emit:n,slots:i}){let r,o=!1;const c=()=>{const S=e.show&&e.forbidClick;o!==S&&(o=S,vt(o))},V=S=>n("update:show",S),T=()=>{e.closeOnClick&&V(!1)},g=()=>clearTimeout(r),b=()=>{const{icon:S,type:v,iconSize:M,iconPrefix:P,loadingType:A}=e;if(S||v==="success"||v==="fail")return d(p,{name:S||v,size:M,class:R("icon"),classPrefix:P},null);if(v==="loading")return d(nt,{class:R("loading"),size:M,type:A},null)},h=()=>{const{type:S,message:v}=e;if(i.message)return d("div",{class:R("text")},[i.message()]);if(O(v)&&v!=="")return S==="html"?d("div",{key:0,class:R("text"),innerHTML:String(v)},null):d("div",{class:R("text")},[v])};return q(()=>[e.show,e.forbidClick],c),q(()=>[e.show,e.type,e.message,e.duration],()=>{g(),e.show&&e.duration>0&&(r=setTimeout(()=>{V(!1)},e.duration))}),fe(c),Ue(c),()=>d(Ye,Q({class:[R([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:T,onClosed:g,"onUpdate:show":V},Ke(e,yt)),{default:()=>[b(),h()]})}});const kt={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let W=[],wt=!1,se=H({},kt);const It=new Map;function me(e){return de(e)?e:{message:e}}function xt(){const{instance:e,unmount:n}=Je({setup(){const i=j(""),{open:r,state:o,close:c,toggle:V}=Xe(),T=()=>{},g=()=>d(St,Q(o,{onClosed:T,"onUpdate:show":V}),null);return q(i,b=>{o.message=b}),Qe().render=g,{open:r,close:c,message:i}}});return e}function Vt(){if(!W.length||wt){const e=xt();W.push(e)}return W[W.length-1]}function Tt(e={}){if(!Ge)return{};const n=Vt(),i=me(e);return n.open(H({},se,It.get(i.type||se.type),i)),n}const Pt=e=>n=>Tt(H({type:e},me(n))),Rt=Pt("success");export{At as F,Lt as a,St as b,Tt as c,Rt as s};
