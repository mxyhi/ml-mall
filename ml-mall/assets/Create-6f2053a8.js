import{c as D,f as I,b7 as M,t as w,ag as j,Y as E,b8 as q,d as F,b as o,p as N,ah as W,aI as J,I as G,a7 as X,a5 as Z,a2 as ee,w as $,n as ne,az as oe,r as T,ap as Q,a9 as te,b9 as ae,ba as H,aM as se,au as L,bb as le,bc as ce,bd as R,be as re,e as ie,aa as de,b5 as ue,b6 as me,_ as fe,z as ge,at as _e,Q as pe,s as A,H as U,V as K,L as ve,U as he,x as be,ax as V,v as Be}from"./user-29809695.js";import{S as Ce}from"./index-7fd4cf85.js";import"./index-7103e571.js";import{F as we}from"./index-5590cd64.js";/* empty css              */import"./index-ae5d72ae.js";import{C as ye}from"./index-1e51679b.js";import"./index-baad5075.js";import"./index-afe6215c.js";import{A as ke}from"./index-f707c078.js";import{c as z}from"./order-b4de2239.js";import"./use-id-06bdbb62.js";import"./index-9381fa7b.js";const[xe,f]=D("action-sheet"),Se=I({},M,{title:String,round:w,actions:j(),closeIcon:E("cross"),closeable:w,cancelText:String,description:String,closeOnPopstate:w,closeOnClickAction:Boolean,safeAreaInsetBottom:w}),Ie=[...q,"round","closeOnPopstate","safeAreaInsetBottom"];var Pe=F({name:xe,props:Se,emits:["select","cancel","update:show"],setup(e,{slots:s,emit:a}){const d=l=>a("update:show",l),t=()=>{d(!1),a("cancel")},_=()=>{if(e.title)return o("div",{class:f("header")},[e.title,e.closeable&&o(G,{name:e.closeIcon,class:[f("close"),X],onClick:t},null)])},y=()=>{if(s.cancel||e.cancelText)return[o("div",{class:f("gap")},null),o("button",{type:"button",class:f("cancel"),onClick:t},[s.cancel?s.cancel():e.cancelText])]},k=(l,B)=>l.loading?o(Z,{class:f("loading-icon")},null):s.action?s.action({action:l,index:B}):[o("span",{class:f("name")},[l.name]),l.subname&&o("div",{class:f("subname")},[l.subname])],b=(l,B)=>{const{color:S,loading:c,callback:r,disabled:p,className:m}=l,n=()=>{p||c||(r&&r(l),e.closeOnClickAction&&d(!1),ee(()=>a("select",l,B)))};return o("button",{type:"button",style:{color:S},class:[f("item",{loading:c,disabled:p}),m],onClick:n},[k(l,B)])},C=()=>{if(e.description||s.description){const l=s.description?s.description():e.description;return o("div",{class:f("description")},[l])}};return()=>o(J,N({class:f(),position:"bottom","onUpdate:show":d},W(e,Ie)),{default:()=>{var l;return[_(),C(),o("div",{class:f("content")},[e.actions.map(b),(l=s.default)==null?void 0:l.call(s)]),y()]}})}});const Te=$(Pe),[Ae,g,P]=D("dialog"),Oe=I({},M,{title:String,theme:String,width:ne,message:[String,Function],callback:Function,allowHtml:Boolean,className:oe,transition:E("van-dialog-bounce"),messageAlign:String,closeOnPopstate:w,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:w,closeOnClickOverlay:Boolean}),De=[...q,"transition","closeOnPopstate"];var Y=F({name:Ae,props:Oe,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:s,slots:a}){const d=T(),t=Q({confirm:!1,cancel:!1}),_=n=>s("update:show",n),y=n=>{var i;_(!1),(i=e.callback)==null||i.call(e,n)},k=n=>()=>{e.show&&(s(n),e.beforeClose?(t[n]=!0,ie(e.beforeClose,{args:[n],done(){y(n),t[n]=!1},canceled(){t[n]=!1}})):y(n))},b=k("cancel"),C=k("confirm"),l=ae(n=>{var i,v;if(n.target!==((v=(i=d.value)==null?void 0:i.popupRef)==null?void 0:v.value))return;({Enter:e.showConfirmButton?C:H,Escape:e.showCancelButton?b:H})[n.key](),s("keydown",n)},["enter","esc"]),B=()=>{const n=a.title?a.title():e.title;if(n)return o("div",{class:g("header",{isolated:!e.message&&!a.default})},[n])},S=n=>{const{message:i,allowHtml:v,messageAlign:h}=e,x=g("message",{"has-title":n,[h]:h}),u=se(i)?i():i;return v&&typeof u=="string"?o("div",{class:x,innerHTML:u},null):o("div",{class:x},[u])},c=()=>{if(a.default)return o("div",{class:g("content")},[a.default()]);const{title:n,message:i,allowHtml:v}=e;if(i){const h=!!(n||a.title);return o("div",{key:v?1:0,class:g("content",{isolated:!h})},[S(h)])}},r=()=>o("div",{class:[ce,g("footer")]},[e.showCancelButton&&o(L,{size:"large",text:e.cancelButtonText||P("cancel"),class:g("cancel"),style:{color:e.cancelButtonColor},loading:t.cancel,disabled:e.cancelButtonDisabled,onClick:b},null),e.showConfirmButton&&o(L,{size:"large",text:e.confirmButtonText||P("confirm"),class:[g("confirm"),{[le]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:t.confirm,disabled:e.confirmButtonDisabled,onClick:C},null)]),p=()=>o(re,{class:g("footer")},{default:()=>[e.showCancelButton&&o(R,{type:"warning",text:e.cancelButtonText||P("cancel"),class:g("cancel"),color:e.cancelButtonColor,loading:t.cancel,disabled:e.cancelButtonDisabled,onClick:b},null),e.showConfirmButton&&o(R,{type:"danger",text:e.confirmButtonText||P("confirm"),class:g("confirm"),color:e.confirmButtonColor,loading:t.confirm,disabled:e.confirmButtonDisabled,onClick:C},null)]}),m=()=>a.footer?a.footer():e.theme==="round-button"?p():r();return()=>{const{width:n,title:i,theme:v,message:h,className:x}=e;return o(J,N({ref:d,role:"dialog",class:[g([v]),x],style:{width:te(n)},tabindex:0,"aria-labelledby":i||h,onKeydown:l,"onUpdate:show":_},W(e,De)),{default:()=>[B(),c(),m()]})}}});let O;const Ee={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let Fe=I({},Ee);function Ne(){({instance:O}=ue({setup(){const{state:s,toggle:a}=me();return()=>o(Y,N(s,{"onUpdate:show":a}),null)}}))}function $e(e){return de?new Promise((s,a)=>{O||Ne(),O.open(I({},Fe,e,{callback:d=>{(d==="confirm"?s:a)(d)}}))}):Promise.resolve()}const He=e=>$e(I({showCancelButton:!0},e));$(Y);const[Le,Re]=D("divider"),Ue={dashed:Boolean,hairline:w,contentPosition:E("center")};var Ke=F({name:Le,props:Ue,setup(e,{slots:s}){return()=>{var a;return o("div",{role:"separator",class:Re({dashed:e.dashed,hairline:e.hairline,[`content-${e.contentPosition}`]:!!s.default})},[(a=s.default)==null?void 0:a.call(s)])}}});const Ve=$(Ke);const ze={class:"container"},Me={class:"address"},qe={class:"goods_list"},We={__name:"Create",setup(e){const s=ge(),a=_e(),d=T("");s.query.orderInfo||a.replace("/cart");const t=T(JSON.parse(decodeURI(atob(s.query.orderInfo||"")||"")||"[]"));console.table(t.value);const _=t.value.goods.map(c=>c.cartId).filter(c=>c);console.log(_);const y=Q([{id:"1",name:t.value.consignee_name,tel:t.value.consignee_phone,address:t.value.consignee_address,isDefault:t.value.isDefault}]),k=()=>{He({message:"退出生成订单?"}).then(()=>{a.replace("/order")}).catch(()=>{})},b=T(!1),C=[{name:"微信",pay_type:1},{name:"支付宝",pay_type:2},{name:"云闪付",pay_type:3}],l=async c=>{const r=t.value.goods.map(n=>({goods_id:n.goods_id,count:n.count}));if(!r.length){a.replace("/order");return}console.log(r);const p={pay_type:c.pay_type,status:2,remark:d.value,price:t.value.price,consignee_name:t.value.consignee_name,consignee_phone:t.value.consignee_phone,consignee_address:t.value.consignee_address,order_goods_infos:r},m=await z(p);if(_.length){const n=await V(_);console.log(n),console.log("--------------------------------------")}console.log(m),console.log(c),a.replace("/order")},B=async()=>{const c=t.value.goods.map(m=>({goods_id:m.goods_id,count:m.count}));if(!c.length){a.replace("/order");return}console.log(c);const r={pay_type:0,status:1,remark:d.value,price:t.value.price,consignee_name:t.value.consignee_name,consignee_phone:t.value.consignee_phone,consignee_address:t.value.consignee_address,order_goods_infos:c},p=await z(r);if(console.log(p),_.length){const m=await V(_);console.log(m)}a.replace("/order")},S=()=>{b.value=!0};return(c,r)=>{const p=pe,m=ke,n=Ve,i=ye,v=we,h=Ce,x=Te;return A(),U("div",ze,[o(p,{"left-arrow":"",onClickLeft:k,title:c.$route.meta.title,placeholder:"",fixed:""},null,8,["title"]),K("div",Me,[o(m,{class:"address_list",list:y,"default-tag-text":"默认",switchable:!1},null,8,["list"]),o(n,{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 0"},dashed:""})]),K("div",qe,[(A(!0),U(ve,null,he(t.value.goods,u=>(A(),Be(i,{key:u.goods_id,num:u.count,price:(u.goodsInfo.price/100).toFixed(2),desc:u.goodsInfo.detail_info,title:u.goodsInfo.name,thumb:u.goodsInfo.pic_url},null,8,["num","price","desc","title","thumb"]))),128))]),o(h,{price:t.value.price,"button-text":"生成订单",onSubmit:S,placeholder:""},{top:be(()=>[o(v,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=u=>d.value=u),modelModifiers:{trim:!0},type:"textarea",label:"备注",placeholder:"备注",rows:"3",maxlength:"50","show-word-limit":"",rules:[{required:!0,message:"请填写备注"}]},null,8,["modelValue"])]),_:1},8,["price"]),o(x,{show:b.value,"onUpdate:show":r[1]||(r[1]=u=>b.value=u),actions:C,"cancel-text":"取消","close-on-click-action":"",onSelect:l,onCancel:B},null,8,["show"])])}}},ln=fe(We,[["__scopeId","data-v-97ce064a"]]);export{ln as default};
